<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS ko configure karein
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        darkbg: '#1a1a1a',
                        cardbg: '#252525',
                        primary: '#3b82f6',
                        secondary: '#ef4444',
                        textlight: '#f9fafb',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-darkbg text-textlight min-h-screen flex items-center justify-center p-4">

    <div class="bg-cardbg p-8 rounded-xl shadow-2xl w-full max-w-4xl text-center flex flex-col items-center">
        <h1 class="text-4xl font-extrabold text-primary mb-2">AI Image Studio</h1>
        <p class="text-gray-400 mb-8">अपनी तस्वीर अपलोड करें और AI से इसे बदलें</p>

        <!-- Image Upload Section -->
        <div class="mb-6 w-full">
            <label for="imageUpload" class="cursor-pointer bg-primary hover:bg-blue-600 text-textlight font-bold py-3 px-6 rounded-full transition duration-300 ease-in-out shadow-lg transform hover:scale-105">
                तस्वीर चुनें (JPEG/PNG)
            </label>
            <input type="file" id="imageUpload" accept="image/jpeg, image/png" class="hidden">
        </div>

        <!-- Image Display Area -->
        <div class="flex flex-col md:flex-row justify-center items-start w-full space-y-4 md:space-y-0 md:space-x-4">
            <!-- User Uploaded Image -->
            <div id="uploadedImageContainer" class="w-full flex justify-center p-2 rounded-xl border border-dashed border-gray-600">
                <img id="uploadedImage" class="max-w-full h-auto rounded-xl shadow-lg transition-transform duration-500 ease-in-out transform hover:scale-105" alt="आपकी तस्वीर" style="max-height: 400px; display: none;">
            </div>

            <!-- Generated Image and Download Button Container -->
            <div id="generatedImageContainer" class="relative w-full flex justify-center p-2 rounded-xl border border-dashed border-gray-600" style="display: none;">
                <img id="generatedImage" class="max-w-full h-auto rounded-xl shadow-lg transition-transform duration-500 ease-in-out transform hover:scale-105" alt="AI द्वारा जनरेट की गई तस्वीर" style="max-height: 400px;">
                <button id="downloadButton" class="absolute bottom-4 right-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full transition duration-300 ease-in-out transform hover:scale-110 shadow-lg">
                    डाउनलोड करें
                </button>
            </div>
        </div>
        
        <!-- Loading and Message Area -->
        <div id="statusMessage" class="mt-6 text-center text-secondary font-semibold" style="display: none;"></div>
        <div id="loadingIndicator" class="mt-6 text-center text-primary" style="display: none;">
            <svg class="animate-spin h-8 w-8 text-primary mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-2">तस्वीर जनरेट हो रही है...</p>
        </div>

        <!-- Prompt Buttons -->
        <div id="buttonContainer" class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4 w-full" style="display: none;">
            <button class="prompt-button bg-gray-700 hover:bg-gray-600 text-textlight font-bold py-3 px-6 rounded-full transition duration-300 ease-in-out" data-prompt="Convert the image to a cartoon style.">इसे कार्टून जैसा बनाओ</button>
            <button class="prompt-button bg-gray-700 hover:bg-gray-600 text-textlight font-bold py-3 px-6 rounded-full transition duration-300 ease-in-out" data-prompt="Convert the image into a watercolor painting.">इसे एक वॉटरकलर पेंटिंग बनाओ</button>
            <button class="prompt-button bg-gray-700 hover:bg-gray-600 text-textlight font-bold py-3 px-6 rounded-full transition duration-300 ease-in-out" data-prompt="Add futuristic sci-fi effects to the image.">फ्यूचरिस्टिक Sci-Fi इफ़ेक्ट जोड़ो</button>
            <button class="prompt-button bg-gray-700 hover:bg-gray-600 text-textlight font-bold py-3 px-6 rounded-full transition duration-300 ease-in-out" data-prompt="Convert the image into a charcoal sketch.">इसे चारकोल स्केच में बदलो</button>
            <button class="prompt-button bg-gray-700 hover:bg-gray-600 text-textlight font-bold py-3 px-6 rounded-full transition duration-300 ease-in-out" data-prompt="Then Create a 1/7 scale commercialized figurine of the characters in the picture, in a realistic style, in a real environment. The figurine is placed on a computer desk. The figurine has a round transparent acrylic base, with no text on the base. The content on the computer screen is a 3D modeling process of this figurine. Next to the computer screen is a toy packaging box, designed in a style reminiscent of high-quality collectible figures, printed with original artwork. The packaging features two-dimensional flat illustrations.">Viral Model Image Generate</button>
        </div>
    </div>

    <script>
        // DOM elements ko get karein
        const imageUpload = document.getElementById('imageUpload');
        const uploadedImage = document.getElementById('uploadedImage');
        const generatedImage = document.getElementById('generatedImage');
        const generatedImageContainer = document.getElementById('generatedImageContainer');
        const buttonContainer = document.getElementById('buttonContainer');
        const downloadButton = document.getElementById('downloadButton');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const statusMessage = document.getElementById('statusMessage');

        const apiKey = ""; // Canvas runtime isko automatic bharega

        imageUpload.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImage.src = e.target.result;
                    uploadedImage.style.display = 'block';
                    buttonContainer.style.display = 'grid'; // Show buttons after image is selected
                    generatedImageContainer.style.display = 'none'; // Hide generated image container
                    statusMessage.style.display = 'none'; // Hide status message
                };
                reader.readAsDataURL(file);
            }
        });

        document.querySelectorAll('.prompt-button').forEach(button => {
            button.addEventListener('click', async function() {
                const prompt = this.getAttribute('data-prompt'); // data-prompt attribute se prompt ko read karein
                const uploadedBase64 = uploadedImage.src.split(',')[1];

                if (!uploadedBase64) {
                    statusMessage.textContent = 'कृपया पहले एक तस्वीर अपलोड करें।';
                    statusMessage.style.display = 'block';
                    return;
                }

                showLoading();

                try {
                    const apiUrl = https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey};
                    
                    const payload = {
                        contents: [{
                            parts: [{
                                text: prompt
                            }, {
                                inlineData: {
                                    mimeType: "image/jpeg",
                                    data: uploadedBase64
                                }
                            }]
                        }],
                        generationConfig: {
                            responseModalities: ["IMAGE"]
                        }
                    };

                    let response = null;
                    let retries = 0;
                    const maxRetries = 3;

                    while (retries < maxRetries) {
                        try {
                            response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(payload)
                            });
                            if (response.status !== 429) {
                                break;
                            }
                        } catch (e) {
                            console.error("Fetch error:", e);
                        }
                        retries++;
                        await new Promise(resolve => setTimeout(resolve, Math.pow(2, retries) * 1000));
                    }

                    if (!response || !response.ok) {
                         const errorBody = await response.json();
                         throw new Error(API Request failed: ${response.statusText} - ${JSON.stringify(errorBody)});
                    }

                    const result = await response.json();
                    const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                    if (base64Data) {
                        generatedImage.src = data:image/jpeg;base64,${base64Data};
                        generatedImageContainer.style.display = 'flex'; // Show generated image container
                    } else {
                        throw new Error('API se koi tasveer nahi mili. Dobara koshish karein.');
                    }
                } catch (error) {
                    statusMessage.textContent = Error: ${error.message};
                    statusMessage.style.display = 'block';
                    console.error('API call failed:', error);
                } finally {
                    hideLoading();
                }
            });
        });

        downloadButton.addEventListener('click', function() {
            const link = document.createElement('a');
            link.href = generatedImage.src;
            link.download = 'ai_generated_image.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
        
        function showLoading() {
            loadingIndicator.style.display = 'block';
            statusMessage.style.display = 'none';
            buttonContainer.style.display = 'none';
            generatedImageContainer.style.display = 'none';
        }

        function hideLoading() {
            loadingIndicator.style.display = 'none';
            buttonContainer.style.display = 'grid';
        }
    </script>

</body>
</html>
